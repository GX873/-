{"version":3,"file":"background.js","sources":["../src/background.ts"],"sourcesContent":["import { VideoData, AccountAnalysis } from './types';\r\n\r\nclass BackgroundService {\r\n  constructor() {\r\n    this.initListeners();\r\n  }\r\n\r\n  private initListeners(): void {\r\n    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n      if (message.type === 'DATA_COLLECTED') {\r\n        this.handleCollectedData(message.data);\r\n      } else if (message.type === 'GET_ACCOUNT_DATA') {\r\n        // 返回测试数据\r\n        sendResponse({\r\n          basicInfo: {\r\n            track: '生活',\r\n            nickname: '测试账号',\r\n            description: '这是一个测试账号的简介',\r\n            homepage: 'https://channels.weixin.qq.com/platform'\r\n          },\r\n          accountStats: {\r\n            likes: 100000,\r\n            favorites: 50000,\r\n            followers: 20000,\r\n            totalVideos: 100,\r\n            viralVideos: 10,\r\n            viralRate: 10\r\n          },\r\n          accountPosition: {\r\n            positioning: '生活分享',\r\n            persona: '邻家大姐姐',\r\n            audience: '18-35岁女性'\r\n          },\r\n          periodStats: {\r\n            days: 30,\r\n            publishedVideos: 30,\r\n            totalInteractions: 50000,\r\n            viralVideosCount: 5,\r\n            recentViralRate: 16.7,\r\n            viralVideoStats: {\r\n              likes: 20000,\r\n              favorites: 10000,\r\n              comments: 5000\r\n            }\r\n          }\r\n        });\r\n        return true; // 保持消息通道开启\r\n      }\r\n    });\r\n  }\r\n\r\n  private async handleCollectedData(data: VideoData[]): Promise<void> {\r\n    try {\r\n      // 存储数据\r\n      await this.saveData(data);\r\n      \r\n      // 发送通知（添加错误处理）\r\n      try {\r\n        await this.sendNotification('数据更新', '新的视频数据已收集完成');\r\n      } catch (notificationError) {\r\n        console.warn('通知发送失败:', notificationError);\r\n      }\r\n    } catch (error) {\r\n      console.error('数据处理错误:', error);\r\n    }\r\n  }\r\n\r\n  private async saveData(data: VideoData[]): Promise<void> {\r\n    const storage = await chrome.storage.local.get('videoData');\r\n    const existingData = storage.videoData || [];\r\n    \r\n    // 合并新旧数据，去重\r\n    const mergedData = [...existingData, ...data].filter((value, index, self) =>\r\n      index === self.findIndex((t) => t.id === value.id)\r\n    );\r\n\r\n    await chrome.storage.local.set({ videoData: mergedData });\r\n  }\r\n\r\n  private async sendNotification(title: string, message: string): Promise<void> {\r\n    if (chrome.notifications) {\r\n      return new Promise((resolve, reject) => {\r\n        chrome.notifications.create({\r\n          type: 'basic',\r\n          iconUrl: 'assets/icon128.png',\r\n          title,\r\n          message\r\n        }, (notificationId) => {\r\n          if (chrome.runtime.lastError) {\r\n            reject(chrome.runtime.lastError);\r\n          } else {\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      console.log('通知功能不可用:', title, message);\r\n    }\r\n  }\r\n}\r\n\r\n// 初始化后台服务\r\nnew BackgroundService(); "],"names":["BackgroundService","message","sender","sendResponse","data","notificationError","error","mergedData","value","index","self","t","title","resolve","reject","notificationId"],"mappings":"AAEA,MAAMA,CAAkB,CACtB,aAAc,CACZ,KAAK,cAAc,CAAA,CAGb,eAAsB,CAC5B,OAAO,QAAQ,UAAU,YAAY,CAACC,EAASC,EAAQC,IAAiB,CAClE,GAAAF,EAAQ,OAAS,iBACd,KAAA,oBAAoBA,EAAQ,IAAI,UAC5BA,EAAQ,OAAS,mBAEb,OAAAE,EAAA,CACX,UAAW,CACT,MAAO,KACP,SAAU,OACV,YAAa,cACb,SAAU,yCACZ,EACA,aAAc,CACZ,MAAO,IACP,UAAW,IACX,UAAW,IACX,YAAa,IACb,YAAa,GACb,UAAW,EACb,EACA,gBAAiB,CACf,YAAa,OACb,QAAS,QACT,SAAU,UACZ,EACA,YAAa,CACX,KAAM,GACN,gBAAiB,GACjB,kBAAmB,IACnB,iBAAkB,EAClB,gBAAiB,KACjB,gBAAiB,CACf,MAAO,IACP,UAAW,IACX,SAAU,GAAA,CACZ,CACF,CACD,EACM,EACT,CACD,CAAA,CAGH,MAAc,oBAAoBC,EAAkC,CAC9D,GAAA,CAEI,MAAA,KAAK,SAASA,CAAI,EAGpB,GAAA,CACI,MAAA,KAAK,iBAAiB,OAAQ,aAAa,QAC1CC,EAAmB,CAClB,QAAA,KAAK,UAAWA,CAAiB,CAAA,QAEpCC,EAAO,CACN,QAAA,MAAM,UAAWA,CAAK,CAAA,CAChC,CAGF,MAAc,SAASF,EAAkC,CAKvD,MAAMG,EAAa,CAAC,IAJJ,MAAM,OAAO,QAAQ,MAAM,IAAI,WAAW,GAC7B,WAAa,CAAC,EAGN,GAAGH,CAAI,EAAE,OAAO,CAACI,EAAOC,EAAOC,IAClED,IAAUC,EAAK,UAAWC,GAAMA,EAAE,KAAOH,EAAM,EAAE,CACnD,EAEA,MAAM,OAAO,QAAQ,MAAM,IAAI,CAAE,UAAWD,EAAY,CAAA,CAG1D,MAAc,iBAAiBK,EAAeX,EAAgC,CAC5E,GAAI,OAAO,cACT,OAAO,IAAI,QAAQ,CAACY,EAASC,IAAW,CACtC,OAAO,cAAc,OAAO,CAC1B,KAAM,QACN,QAAS,qBACT,MAAAF,EACA,QAAAX,CACF,EAAIc,GAAmB,CACjB,OAAO,QAAQ,UACVD,EAAA,OAAO,QAAQ,SAAS,EAEvBD,EAAA,CACV,CACD,CAAA,CACF,EAEO,QAAA,IAAI,WAAYD,EAAOX,CAAO,CACxC,CAEJ,CAGA,IAAID"}